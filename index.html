<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kalino v2 â€” ÙØ±ÙˆØ´Ú¯Ø§Ù‡</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --white:#ffffff;
    --muted:#f4f6f8;
    --surface:#f1f3f5;
    --text:#111214;
    --sub:#69707a;
    --accent:#ff5a5f; /* kept for small accents if needed */
    --green:#41b883;
    --shadow: 0 6px 18px rgba(16,24,40,0.06);
    --glass: rgba(255,255,255,0.6);
  }
  /* Reset */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:'Vazirmatn',sans-serif;
    background:var(--white);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    direction:rtl;
    padding-bottom:88px; /* for bottom nav */
  }

  /* Header */
  header{
    position:sticky;top:0;z-index:40;
    display:flex;align-items:center;justify-content:center;
    padding:12px 16px;background:linear-gradient(180deg,#ffffff, #fbfdff 60%);
    border-bottom:1px solid #eef1f4;
    backdrop-filter: blur(6px);
  }
  header .left {
    position:absolute; left:12px; top:8px; display:flex; gap:8px; align-items:center;
  }
  .brand{font-weight:700;font-size:18px}
  .icon-btn{
    width:44px;height:44px;border-radius:12px;background:var(--muted);
    display:inline-flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid #e8edf1;
    transition:transform .12s ease;
  }
  .icon-btn:active{transform:scale(.98)}

  /* Search */
  .search-wrap{padding:12px 16px}
  .search{
    width:100%;display:flex;align-items:center;gap:10px;
    background:var(--surface);padding:10px;border-radius:12px;box-shadow:var(--shadow);
  }
  .search input{
    flex:1;border:0;background:transparent;outline:none;font-size:15px;color:var(--text);
  }
  .search input::placeholder{color:var(--sub);opacity:0.9}
  .search .btn{
    padding:8px 10px;border-radius:10px;border:0;background:var(--white);box-shadow:0 2px 8px rgba(0,0,0,.06);
    cursor:pointer;font-weight:600;font-size:14px;
  }

  main{padding:6px 16px 120px}
  h2.section-title{font-size:16px;margin-bottom:12px;font-weight:700}

  /* Categories */
  .categories{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .cat-card{
    background:var(--muted);padding:10px;border-radius:12px;text-align:center;cursor:pointer;
    transition:transform .14s ease,box-shadow .14s ease;
  }
  .cat-card:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(16,24,40,0.06)}
  .cat-card .emoji{font-size:20px;margin-bottom:6px}

  /* Carousel / products */
  .carousel{display:flex;gap:12px;overflow-x:auto;padding-bottom:6px}
  .carousel::-webkit-scrollbar{height:8px}
  .prod-card{
    min-width:172px;background:var(--white);border-radius:12px;padding:10px;flex-shrink:0;
    box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px;
  }
  .prod-card img{width:100%;height:110px;object-fit:cover;border-radius:8px}
  .prod-card .title{font-weight:600;font-size:14px}
  .prod-card .price{color:var(--green);font-weight:600}
  .prod-card .actions{display:flex;gap:8px;align-items:center;margin-top:auto}
  .btn-primary{
    flex:1;padding:8px;border-radius:10px;border:0;background:var(--green);color:#fff;cursor:pointer;font-weight:600;
  }
  .btn-outline{padding:8px;border-radius:10px;border:1px solid #e6eaee;background:transparent;cursor:pointer}

  /* Pages */
  .page{display:none}
  .page.active{display:block}

  /* Cart list */
  .cart-list{display:flex;flex-direction:column;gap:10px}
  .cart-item{
    display:flex;gap:12px;align-items:center;background:var(--muted);padding:10px;border-radius:12px;
  }
  .cart-item img{width:72px;height:72px;border-radius:8px;object-fit:cover}
  .cart-item-info{flex:1;display:flex;flex-direction:column;gap:6px}
  .cart-item-title{font-weight:700}
  .cart-item-price{color:var(--green);font-weight:600}
  .qty-controls{display:flex;align-items:center;gap:8px}
  .qty-controls button{width:34px;height:34px;border-radius:8px;border:0;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.06);cursor:pointer}
  .remove-btn{background:transparent;border:0;color:var(--accent);font-size:18px;cursor:pointer}

  .cart-footer{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;margin-top:8px;background:linear-gradient(180deg,#fff,#fbfdff)}
  .total{font-weight:700;font-size:16px}
  .checkout{padding:10px 14px;border-radius:12px;background:var(--green);color:#fff;border:0;cursor:pointer;font-weight:700}

  /* Account page */
  .account-card{background:var(--muted);padding:12px;border-radius:12px;display:flex;flex-direction:column;gap:10px}
  .account-row{display:flex;justify-content:space-between;align-items:center}
  .small-btn{padding:8px 10px;border-radius:10px;border:0;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.06);cursor:pointer}
  .orders-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .order-item{background:#fff;padding:10px;border-radius:10px;box-shadow:var(--shadow);font-size:14px}

  /* Toast */
  .toast{
    position:fixed;left:50%;transform:translateX(-50%);bottom:92px;background:rgba(20,20,20,.9);
    color:#fff;padding:10px 14px;border-radius:10px;font-weight:600;z-index:60;opacity:0;pointer-events:none;
    transition:opacity .18s ease,transform .18s ease;
  }
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px);pointer-events:auto}

  /* Bottom nav */
  .bottom-nav{
    position:fixed;left:0;right:0;bottom:0;height:72px;background:var(--white);
    display:flex;justify-content:space-around;align-items:center;border-top:1px solid #eef1f4;z-index:50;
  }
  .bottom-btn{display:flex;flex-direction:column;align-items:center;gap:4px;color:var(--sub);cursor:pointer;font-size:12px}
  .bottom-btn.active{color:var(--green);font-weight:700}

  /* Responsive */
  @media (min-width:720px){
    main{max-width:900px;margin:0 auto}
    .categories{grid-template-columns:repeat(6,1fr)}
  }
  @media (max-width:420px){
    .categories{grid-template-columns:repeat(3,1fr)}
    .prod-card{min-width:150px}
  }
</style>
</head>
<body>

<header>
  <div class="left">
    <div class="icon-btn" id="userBtn" title="Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ">ğŸ‘¤</div>
  </div>
  <div class="brand">Kalino</div>
</header>

<div class="search-wrap">
  <div class="search" role="search">
    <input id="searchInput" placeholder="Ú†ÛŒ Ù„Ø§Ø²Ù… Ø¯Ø§Ø±ÛŒØŸ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†..." aria-label="Ø¬Ø³ØªØ¬Ùˆ Ù…Ø­ØµÙˆÙ„Ø§Øª" />
    <button class="btn btn-primary" id="clearSearch" title="Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†">Ã—</button>
    <button class="btn btn-outline" id="doSearch" title="Ø¬Ø³ØªØ¬Ùˆ">Ø¬Ø³ØªØ¬Ùˆ</button>
  </div>
</div>

<main>
  <!-- HOME PAGE -->
  <section class="page active" id="homePage">
    <div style="margin-bottom:14px">
      <h2 class="section-title">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h2>
      <div class="categories" id="categoriesList"></div>
    </div>

    <div style="margin-bottom:14px">
      <h2 class="section-title">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§</h2>
      <div class="carousel" id="productsCarousel"></div>
    </div>

    <div>
      <h2 class="section-title">ØªØ®ÙÛŒÙØ§Øª ÙˆÛŒÚ˜Ù‡</h2>
      <div class="carousel" id="promoCarousel"></div>
    </div>
  </section>

  <!-- CART PAGE -->
  <section class="page" id="cartPage">
    <h2 class="section-title">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h2>
    <div id="cartContent">
      <div class="cart-list" id="cartItems"></div>
      <div class="cart-footer" id="cartFooter" style="display:none">
        <div>
          <div style="font-size:13px;color:var(--sub)">Ø¬Ù…Ø¹ Ú©Ù„</div>
          <div class="total" id="cartTotal">Û° ØªÙˆÙ…Ø§Ù†</div>
        </div>
        <div>
          <button class="checkout" id="checkoutBtn">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ACCOUNT PAGE -->
  <section class="page" id="accountPage">
    <h2 class="section-title">Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</h2>
    <div class="account-card">
      <div style="display:flex;gap:12px;align-items:center">
        <div style="width:64px;height:64px;border-radius:12px;background:var(--muted);display:flex;align-items:center;justify-content:center;font-size:28px">ğŸ‘¤</div>
        <div style="flex:1">
          <div id="acctName" style="font-weight:700">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±</div>
          <div id="acctPhone" style="color:var(--sub);margin-top:4px">Û°Û¹Û°Û°Û°Û°Û°Û°Û°Û°</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="small-btn" id="editProfileBtn">ÙˆÛŒØ±Ø§ÛŒØ´</button>
          <button class="small-btn" id="logoutBtn">Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
        <div>
          <div style="font-size:13px;color:var(--sub)">Ú©ÛŒÙ Ù¾ÙˆÙ„</div>
          <div id="walletAmount" style="font-weight:700">Û° ØªÙˆÙ…Ø§Ù†</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="topupValue" type="number" min="1000" placeholder="Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)" style="padding:8px;border-radius:10px;border:1px solid #e6eaee;background:#fff" />
          <button class="small-btn" id="topupBtn">Ø§ÙØ²Ø§ÛŒØ´</button>
        </div>
      </div>

      <div style="margin-top:8px">
        <div style="font-weight:700;margin-bottom:8px">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</div>
        <div class="orders-list" id="ordersList">
          <div style="color:var(--sub)">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Bottom nav -->
<nav class="bottom-nav" role="navigation" aria-label="Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù¾Ø§ÛŒÛŒÙ†">
  <div class="bottom-btn active" data-page="homePage">ğŸ <div>Ø®Ø§Ù†Ù‡</div></div>
  <div class="bottom-btn" data-page="cartPage">ğŸ›’<div>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ <span id="cartBadge" style="font-size:11px;margin-right:6px;color:var(--green)"></span></div></div>
  <div class="bottom-btn" data-page="accountPage">ğŸ‘¤<div>Ø­Ø³Ø§Ø¨</div></div>
</nav>

<!-- Toast -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
  // ---------- Ø¯Ø§Ø¯Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ ----------
  const categories = [
    { title: 'Ø¯Ø³ØªÙ…Ø§Ù„ Ùˆ Ø´ÙˆÛŒÙ†Ø¯Ù‡', emoji: 'ğŸ§¼' },
    { title: 'Ù„Ø¨Ù†ÛŒØ§Øª', emoji: 'ğŸ¥›' },
    { title: 'Ø®ÙˆØ§Ø± Ùˆ Ø¨Ø§Ø±', emoji: 'ğŸ›’' },
    { title: 'Ø¢Ø±Ø§ÛŒØ´ Ùˆ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ', emoji: 'ğŸ’„' },
    { title: 'Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ', emoji: 'ğŸ¥¤' },
    { title: 'ØªÙ†Ù‚Ù„Ø§Øª', emoji: 'ğŸ«' },
    { title: 'ØµØ¨Ø­Ø§Ù†Ù‡', emoji: 'ğŸ¥' },
    { title: 'Ú©Ù†Ø³Ø±Ùˆ', emoji: 'ğŸ¥«' },
  ];

  const products = [
    { id: 'p1', name: 'Ú†ÛŒÙ¾Ø³ Ù†Ù…Ú©ÛŒ', price: 20000, img: 'https://via.placeholder.com/400x300?text=Ú†ÛŒÙ¾Ø³' },
    { id: 'p2', name: 'Ø´ÛŒØ± Ú©Ù… Ú†Ø±Ø¨ 1L', price: 15000, img: 'https://via.placeholder.com/400x300?text=Ø´ÛŒØ±' },
    { id: 'p3', name: 'Ú©Ù†Ø³Ø±Ùˆ Ù„ÙˆØ¨ÛŒØ§', price: 12000, img: 'https://via.placeholder.com/400x300?text=Ú©Ù†Ø³Ø±Ùˆ' },
    { id: 'p4', name: 'Ú©Ø§Ù„Ø¨Ø§Ø³ ÙˆÛŒÚ˜Ù‡', price: 45000, img: 'https://via.placeholder.com/400x300?text=Ú©Ø§Ù„Ø¨Ø§Ø³' },
    { id: 'p5', name: 'Ù†ÙˆØ´Ø§Ø¨Ù‡ Ù‚ÙˆØ·ÛŒ', price: 8000, img: 'https://via.placeholder.com/400x300?text=Ù†ÙˆØ´Ø§Ø¨Ù‡' },
    { id: 'p6', name: 'Ú©ÛŒÚ© ØµØ¨Ø­Ø§Ù†Ù‡', price: 22000, img: 'https://via.placeholder.com/400x300?text=Ú©ÛŒÚ©' },
  ];

  // ---------- Ø­Ø§Ù„Øª Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­Ù„ÛŒ ----------
  const LS_CART = 'kalino_cart_v2';
  const LS_USER = 'kalino_user_v2';
  const LS_ORDERS = 'kalino_orders_v2';

  let cart = JSON.parse(localStorage.getItem(LS_CART) || '[]');
  let user = JSON.parse(localStorage.getItem(LS_USER) || '{}');
  let orders = JSON.parse(localStorage.getItem(LS_ORDERS) || '[]');

  // ---------- Ú©Ù…Ú©â€ŒÚ©Ù†Ù†Ø¯Ù‡â€ŒÙ‡Ø§ ----------
  function formatToman(n){
    // n integer
    return n.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
  }

  function toast(msg, time=1800){
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    clearTimeout(t._hide);
    t._hide = setTimeout(()=> t.classList.remove('show'), time);
  }

  function saveCart(){ localStorage.setItem(LS_CART, JSON.stringify(cart)) }
  function saveUser(){ localStorage.setItem(LS_USER, JSON.stringify(user)) }
  function saveOrders(){ localStorage.setItem(LS_ORDERS, JSON.stringify(orders)) }

  // ---------- Ø±Ù†Ø¯Ø± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ù…Ø­ØµÙˆÙ„Ø§Øª ----------
  const categoriesList = document.getElementById('categoriesList');
  categories.forEach(c=>{
    const d = document.createElement('div');
    d.className = 'cat-card';
    d.tabIndex = 0;
    d.innerHTML = `<div class="emoji">${c.emoji}</div><div style="font-weight:600">${c.title}</div>`;
    categoriesList.appendChild(d);
    // Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯ Ú©Ù‡ ÙÛŒÙ„ØªØ± Ú©Ù†Ø¯
  });

  const productsCarousel = document.getElementById('productsCarousel');
  function renderProducts(list){
    productsCarousel.innerHTML = '';
    list.forEach(p=>{
      const card = document.createElement('div');
      card.className = 'prod-card';
      card.innerHTML = `
        <img src="${p.img}" alt="${p.name}">
        <div class="title">${p.name}</div>
        <div class="price">${formatToman(p.price)}</div>
        <div class="actions">
          <button class="btn-outline" data-action="details" data-id="${p.id}">Ø¬Ø²Ø¦ÛŒØ§Øª</button>
          <button class="btn-primary" data-action="add" data-id="${p.id}">Ø§ÙØ²ÙˆØ¯Ù†</button>
        </div>
      `;
      productsCarousel.appendChild(card);
    });
  }
  renderProducts(products);

  // ---------- Ù†ÙˆØ§Ø± Ø¬Ø³ØªØ¬Ùˆ ----------
  const searchInput = document.getElementById('searchInput');
  const doSearch = document.getElementById('doSearch');
  const clearSearch = document.getElementById('clearSearch');

  function applySearch(){
    const q = searchInput.value.trim().toLowerCase();
    if(!q){ renderProducts(products); toast('Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡Ù” Ù…Ø­ØµÙˆÙ„Ø§Øª'); return; }
    const res = products.filter(p => p.name.includes(q));
    renderProducts(res);
    toast(`${res.length} Ù†ØªÛŒØ¬Ù‡ Ø¨Ø±Ø§ÛŒ "${searchInput.value}"`);
  }
  doSearch.addEventListener('click', applySearch);
  searchInput.addEventListener('keydown', e => { if(e.key === 'Enter') applySearch() });
  clearSearch.addEventListener('click', ()=>{ searchInput.value=''; renderProducts(products); });

  // ---------- Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ ----------
  const cartItemsContainer = document.getElementById('cartItems');
  const cartTotalSpan = document.getElementById('cartTotal');
  const cartFooter = document.getElementById('cartFooter');
  const cartBadge = document.getElementById('cartBadge');

  function calcCartTotals(){
    let total = 0;
    let count = 0;
    for(const it of cart){
      // careful arithmetic: compute price * quantity explicitly
      const line = Number(it.price) * Number(it.quantity);
      total += line;
      count += Number(it.quantity);
    }
    return { total, count };
  }

  function updateCartUI(){
    cartItemsContainer.innerHTML = '';
    if(cart.length === 0){
      cartItemsContainer.innerHTML = `<div style="color:var(--sub)">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</div>`;
      cartFooter.style.display = 'none';
      cartBadge.textContent = '';
      return;
    }
    cartFooter.style.display = 'flex';
    const { total, count } = calcCartTotals();
    cartTotalSpan.textContent = formatToman(total);
    cartBadge.textContent = count > 0 ? `(${count})` : '';

    cart.forEach((item, idx) => {
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerHTML = `
        <img src="${item.img}" alt="${item.name}">
        <div class="cart-item-info">
          <div class="cart-item-title">${item.name}</div>
          <div class="cart-item-price">${formatToman(item.price)} Ã— ${item.quantity} = ${formatToman(item.price * item.quantity)}</div>
          <div class="qty-controls" data-idx="${idx}">
            <button data-op="minus" title="Ú©Ù… Ú©Ø±Ø¯Ù†">âˆ’</button>
            <div style="min-width:36px;text-align:center;font-weight:700">${item.quantity}</div>
            <button data-op="plus" title="Ø§ÙØ²Ø§ÛŒØ´">+</button>
            <button style="margin-left:8px" class="remove-btn" data-op="remove" title="Ø­Ø°Ù">Ø­Ø°Ù</button>
          </div>
        </div>
      `;
      cartItemsContainer.appendChild(div);
    });
    saveCart();
  }

  // delegation for qty controls
  cartItemsContainer.addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const parent = e.target.closest('.qty-controls');
    if(!parent) return;
    const idx = Number(parent.dataset.idx);
    const op = btn.dataset.op;
    if(isNaN(idx) || !cart[idx]) return;

    if(op === 'plus'){
      cart[idx].quantity = Number(cart[idx].quantity) + 1;
      toast('ØªØ¹Ø¯Ø§Ø¯ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª');
    } else if(op === 'minus'){
      cart[idx].quantity = Number(cart[idx].quantity) - 1;
      if(cart[idx].quantity <= 0){
        cart.splice(idx,1);
        toast('Ù…Ø­ØµÙˆÙ„ Ø§Ø² Ø³Ø¨Ø¯ Ø­Ø°Ù Ø´Ø¯');
      } else {
        toast('ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª');
      }
    } else if(op === 'remove'){
      cart.splice(idx,1);
      toast('Ù…Ø­ØµÙˆÙ„ Ø­Ø°Ù Ø´Ø¯');
    }
    updateCartUI();
  });

  // ---------- Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ Ø¨Ù‡ Ø³Ø¨Ø¯ (Ø§Ø² Ù…Ø­ØµÙˆÙ„Ø§Øª) ----------
  productsCarousel.addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const action = btn.dataset.action;
    const id = btn.dataset.id;
    const product = products.find(p => p.id === id);
    if(!product) return;

    if(action === 'add'){
      const existing = cart.find(it => it.id === product.id);
      if(existing){ existing.quantity = Number(existing.quantity) + 1; }
      else { cart.push({...product, quantity:1}); }
      toast(`"${product.name}" Ø¨Ù‡ Ø³Ø¨Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`);
      updateCartUI();
    } else if(action === 'details'){
      toast(`${product.name} â€” ${formatToman(product.price)}`);
    }
  });

  // ---------- checkout: Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ§Ø±Ø´ Ùˆ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø³Ø¨Ø¯ ----------
  const checkoutBtn = document.getElementById('checkoutBtn');
  checkoutBtn.addEventListener('click', ()=>{
    if(cart.length === 0){ toast('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª'); return; }
    // subtract wallet if user wants? here: just record order
    const { total } = calcCartTotals();
    const order = {
      id: 'order_' + Date.now(),
      items: JSON.parse(JSON.stringify(cart)),
      total,
      createdAt: new Date().toISOString()
    };
    orders.unshift(order);
    saveOrders();
    cart = [];
    saveCart();
    updateCartUI();
    renderOrders();
    toast('Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯. Ù…Ù…Ù†ÙˆÙ† Ø§Ø² Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§!');
    showPage('homePage');
  });

  // ---------- Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ ----------
  const acctName = document.getElementById('acctName');
  const acctPhone = document.getElementById('acctPhone');
  const walletAmount = document.getElementById('walletAmount');
  const ordersList = document.getElementById('ordersList');
  const editProfileBtn = document.getElementById('editProfileBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const topupBtn = document.getElementById('topupBtn');
  const topupValue = document.getElementById('topupValue');

  function ensureUser(){
    if(!user.name) user = { name: 'Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù†', phone: 'Û°Û¹Û°Û°Û°Û°Û°Û°Û°Û°', wallet: 0 };
    saveUser();
  }
  ensureUser();

  function renderAccount(){
    acctName.textContent = user.name || 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±';
    acctPhone.textContent = user.phone || 'Û°Û¹Û°Û°Û°Û°Û°Û°Û°';
    walletAmount.textContent = formatToman(Number(user.wallet || 0));
  }
  renderAccount();

  function renderOrders(){
    ordersList.innerHTML = '';
    if(orders.length === 0){
      ordersList.innerHTML = '<div style="color:var(--sub)">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>';
      return;
    }
    orders.forEach(o=>{
      const d = document.createElement('div');
      d.className = 'order-item';
      const date = new Date(o.createdAt);
      const itemsSummary = o.items.map(it => `${it.name} Ã— ${it.quantity}`).join('ØŒ ');
      d.innerHTML = `<div style="font-weight:700">#${o.id.split('_')[1]}</div>
                     <div style="color:var(--sub);font-size:13px;margin-top:6px">${itemsSummary}</div>
                     <div style="display:flex;justify-content:space-between;margin-top:8px">
                       <div style="font-weight:700">${formatToman(o.total)}</div>
                       <div style="color:var(--sub);font-size:13px">${date.toLocaleString('fa-IR')}</div>
                     </div>`;
      ordersList.appendChild(d);
    });
  }
  renderOrders();

  editProfileBtn.addEventListener('click', ()=>{
    // Ø³Ø§Ø¯Ù‡: prompt Ø¨Ø±Ø§ÛŒ Ù†Ø§Ù… Ùˆ Ø´Ù…Ø§Ø±Ù‡ (Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… modal Ø²ÛŒØ¨Ø§ØªØ± Ø¨Ø³Ø§Ø²ÛŒÙ…)
    const newName = prompt('Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:', user.name || '');
    if(newName === null) return;
    const newPhone = prompt('Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:', user.phone || '');
    if(newPhone === null) return;
    user.name = newName.trim() || user.name;
    user.phone = newPhone.trim() || user.phone;
    saveUser();
    renderAccount();
    toast('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯');
  });

  logoutBtn.addEventListener('click', ()=>{
    if(confirm('Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÙˆØ¬ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ')) {
      user = { name:'Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù†', phone:'Û°Û¹Û°Û°Û°Û°Û°Û°Û°Û°', wallet:0 };
      saveUser();
      renderAccount();
      toast('Ø´Ù…Ø§ Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯');
    }
  });

  topupBtn.addEventListener('click', ()=>{
    const v = Number(topupValue.value);
    if(!v || v < 1000){ toast('Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø­Ø¯Ø§Ù‚Ù„ Û±Û°Û°Û° ØªÙˆÙ…Ø§Ù†)'); return; }
    user.wallet = Number(user.wallet || 0) + v;
    saveUser();
    renderAccount();
    topupValue.value = '';
    toast('Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø´Ø§Ø±Ú˜ Ø´Ø¯');
  });

  // ---------- ØµÙØ­Ø§Øª Ùˆ Ù†Ø§ÙˆØ¨Ø±ÛŒ ----------
  const pages = document.querySelectorAll('.page');
  const navBtns = document.querySelectorAll('.bottom-btn');

  function showPage(id){
    pages.forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    navBtns.forEach(b => b.classList.remove('active'));
    document.querySelector(`.bottom-btn[data-page='${id}']`)?.classList.add('active');
  }

  navBtns.forEach(b => b.addEventListener('click', ()=> showPage(b.dataset.page)));

  // user icon on header opens account page
  document.getElementById('userBtn').addEventListener('click', ()=> {
    showPage('accountPage');
    toast('ØµÙØ­Ù‡ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ø² Ø´Ø¯');
  });

  // ---------- Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ UI ----------
  updateCartUI();
  renderAccount();

  // ---------- Ú©Ù…Ú©: Ù†Ù…Ø§ÛŒØ´ Ø³Ø§Ø¯Ù‡ Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ø³Ø§ÛŒØ¯ promo ----------
  const promoCarousel = document.getElementById('promoCarousel');
  const promos = products.slice(0,3);
  promos.forEach(p=>{
    const el = document.createElement('div');
    el.className = 'prod-card';
    el.style.minWidth='220px';
    el.innerHTML = `<img src="${p.img}" alt="${p.name}">
      <div class="title">${p.name}</div>
      <div class="price">${formatToman(p.price)}</div>
      <div style="display:flex;justify-content:flex-end;margin-top:auto"><button class="btn-primary" data-id="${p.id}" data-action="add">Ø§Ø¶Ø§ÙÙ‡</button></div>`;
    promoCarousel.appendChild(el);
  });

  // add from promos to cart (delegation)
  promoCarousel.addEventListener('click', (e)=>{
    const b = e.target.closest('button');
    if(!b) return;
    const id = b.dataset.id;
    const product = products.find(x => x.id === id);
    if(!product) return;
    const ex = cart.find(it=>it.id===product.id);
    if(ex) ex.quantity = Number(ex.quantity) + 1;
    else cart.push({...product, quantity:1});
    updateCartUI();
    toast('Ø¨Ù‡ Ø³Ø¨Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
  });

  // ---------- Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø¢Ú¯Ø§Ù‡Ø§Ù†Ù‡ Ø§Ø² localStorage: save on unload ----------
  window.addEventListener('beforeunload', ()=>{
    saveCart(); saveUser(); saveOrders();
  });

  // ---------- Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø±Ø§Ø³Øªâ€ŒØ¨Ù‡â€ŒÚ†Ù¾ Ùˆ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ ----------
  // (Ø§Ø®ØªÛŒØ§Ø±ÛŒ) Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ø§ ÙØ§Ø±Ø³ÛŒ Ú©Ø±Ø¯ â€” ÙØ¹Ù„Ø§Ù‹ Ø§Ø² toLocaleString('fa-IR') Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡

</script>
</body>
</html>
